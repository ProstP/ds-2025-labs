# PA4. Шаблон взаимодействия Publisher-Subscriber (Издатель-Подписчик)

**Цель:** научиться организовывать взаимодействие компонентов РС на основе публикации событий и подписки на них

# Задание

*Задание делается на базе задания PA3*

## 1. Добавить события в системе

>Ниже под *событием* понимается сообщение с информацией о событии, публикуемое в брокер сообщений.

Необходимо добавить публикацию двух типов событий:

1. *RankCalculated* — возникает после вычисления и сохранения в БД значения метрики *rank*;
2. *SimilarityCalculated* — возникает после вычисления и сохранения в БД значения метрики *similarity*

События должны публиковаться компонентами, в которых производятся вычисления:

1. Фоновый сервис *RankCalculator* публикует событие *RankCalculated*
2. Web-приложение *Valuator* публикует событие *SimilarityCalculated* в обработчике POST-запроса

Сообщения событий должны содержать информацию, относящуюся к контексту события:

1. Идентификатор сущности или контекста — в нашем случае это идентификатор текста в БД
2. Другие данные, описывающие изменение состояния системы в результате наступления события 
    * Для *RankCalculated* разумно передавать значение оценки *rank*
    * Для *SimilarityCalculated* — значение *similarity*

## 2. Добавить новый компонент

Необходимо добавить новый компонент *EventsLogger*, который подписывается на оба события и выводит в консоль информацию о них:

1. Название типа события
2. Идентификатор сущности или контекста
3. Значение *rank* для события *RankCalculated*
4. Значение *similarity* для события *SimilarityCalculated*

В скриптах автоматизации запуска либо в docker-compose.yaml нужно добавить команды для запуска и останова двух экземпляров *EventsLogger*

## 3. Нарисовать C4 диаграмму контейнеров

Перед сдачей работы следует нарисовать C4 диаграмму контейнеров со всеми компонентами системы, включая браузер:

- диаграмму можно нарисовать на бумаге либо сделать в приложении [draw.io](https://github.com/jgraph/drawio-desktop/releases)
- на диаграмме предстоит показать, как взаимодействуют сервисы Valuator, RankCalculator и EventsLogger

# Полезные ссылки

1. Описание шаблона "Издатель-Подписчик" https://docs.microsoft.com/en-us/azure/architecture/patterns/publisher-subscriber
2. Руководство [RabbitMQ tutorial - Publish/Subscribe](https://www.rabbitmq.com/tutorials/tutorial-three-dotnet) для C#/.NET
3. Руководство [RabbitMQ tutorial - Publish/Subscribe](https://www.rabbitmq.com/tutorials/tutorial-three-go) для Go
4. Руководство [Core Publish-Subscribe in Messaging](https://examples.nats.io/examples/messaging/pub-sub/csharp) для NATS и C#/.NET
